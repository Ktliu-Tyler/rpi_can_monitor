<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NTURT Dynamic Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/static/dashboard.css">
    <script src="/static/main.js"></script>
</head>
<body class="min-h-screen">
    <!-- Connection Status -->
    <div id="connection-status" class="connection-indicator disconnected">
        <span id="connection-text">Connecting...</span>
    </div>

    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="glass-card rounded-lg p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                        NTUR Dynamic Dashboard
                    </h1>
                    <p class="text-slate-400 mt-2">Real-time Racing Telemetry System</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-slate-400">Messages</div>
                    <div id="message-count" class="text-3xl font-bold text-cyan-400">0</div>
                    <div class="text-xs text-slate-500" id="last-update">Waiting for data...</div>
                </div>
            </div>
        </div>
        <!-- Playback Controls -->
        <div id="floating-controls" class="floating-control-panel">
            <div class="floating-header">
                <h3 class="floating-title">PLAYER CONTROL</h3>
                <div class="floating-actions">
                    <button id="minimize-btn" class="control-action-btn" title="Xs">‚ûñ</button>
                    <button id="close-btn" class="control-action-btn" title="close">‚úñÔ∏è</button>
                </div>
            </div>
            
            <div id="control-content" class="floating-content">
                <div class="control-row">
                    <div class="control-group">
                        <button id="backward-btn" class="control-btn secondary">
                            ‚è™ -10s
                        </button>
                        <button id="play-pause-btn" class="control-btn primary">
                            ‚è∏Ô∏è STOP
                        </button>
                        <button id="forward-btn" class="control-btn secondary">
                            ‚è© +10s
                        </button>
                    </div>
                </div>
                
                <div class="control-row">
                    <div class="control-group">
                        <button id="mode-toggle-btn" class="control-btn secondary" title="Switch between CSV and CAN mode">
                            üìÅ CSV Mode
                        </button>
                    </div>
                </div>
                
                <!-- CAN Logging Controls -->
                <div class="control-row">
                    <div class="control-group">
                        <button id="start-logging-btn" class="control-btn secondary" title="Start CAN logging">
                            üü¢ START LOG
                        </button>
                        <button id="stop-logging-btn" class="control-btn secondary" title="Stop CAN logging">
                            üî¥ STOP LOG
                        </button>
                    </div>
                </div>
                
                <div class="control-row">
                    <div class="control-group">
                        <label class="control-label">SPEED:</label>
                        <select id="speed-select" class="control-select">
                            <option value="0.1">0.1x</option>
                            <option value="0.5">0.5x</option>
                            <option value="1" selected>1x</option>
                            <option value="2">2x</option>
                            <option value="5">5x</option>
                            <option value="10">10x</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">FILE:</label>
                        <select id="file-select" class="control-select">
                            <option value="">Loading...</option>
                        </select>
                    </div>
                </div>
                
                <div class="control-row">
                    <div class="progress-container">
                        <div class="time-display">
                            <span id="current-time" class="time-text">00:00</span>
                            <span id="total-time" class="time-text">00:00</span>
                        </div>
                        <input type="range" id="progress-bar" min="0" max="100" value="0" 
                            class="progress-slider">
                    </div>
                </div>
            </div>
        </div>

        <!-- Êá∏ÊµÆÊéßÂà∂Èù¢ÊùøËß∏ÁôºÊåâÈàï -->
        <button id="show-controls-btn" class="show-controls-btn" style="display: none;">
            CONTROL PANEL
        </button>

        <!-- Battery Information Bar -->
        <div class="glass-card rounded-lg p-4 mb-6">
            <h3 class="text-lg font-bold text-white mb-3 flex items-center">
                <svg class="w-5 h-5 mr-2 text-yellow-400" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V20c0 .73.6 1.33 1.33 1.33h8.34c.73 0 1.33-.6 1.33-1.33V5.33C18 4.6 17.4 4 16.67 4z"/>
                </svg>
                Battery Status
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- State of Charge -->
                <div class="bg-slate-800/50 backdrop-blur rounded-lg p-3 border border-slate-700">
                    <div class="text-sm text-slate-300 mb-1">State of Charge</div>
                    <div class="bg-slate-700 rounded-full h-4 mb-2 overflow-hidden">
                        <div id="battery-soc-bar" class="battery-bar bg-green-500 h-full rounded transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span id="battery-soc-value" class="text-white font-bold text-lg">0%</span>
                        <span class="text-xs text-slate-400">SOC</span>
                    </div>
                </div>

                <!-- Battery Temperature -->
                <div class="bg-slate-800/50 backdrop-blur rounded-lg p-3 border border-slate-700">
                    <div class="text-sm text-slate-300 mb-1">Temperature</div>
                    <div class="flex items-center justify-between">
                        <div>
                            <div id="battery-temp-value" class="text-green-400 font-bold text-xl">--¬∞C</div>
                            <div class="text-xs text-slate-400">Pack Temp</div>
                        </div>
                        <svg class="w-8 h-8 text-orange-400" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M15 13V5c0-1.66-1.34-3-3-3S9 3.34 9 5v8c-1.21.91-2 2.37-2 4 0 2.76 2.24 5 5 5s5-2.24 5-5c0-1.63-.79-3.09-2-4zM11 5c0-.55.45-1 1-1s1 .45 1 1h-2v0zm4 12c0 1.66-1.34 3-3 3s-3-1.34-3-3c0-1 .49-1.88 1.24-2.42L11 14V6h2v8l.76.58C14.51 15.12 15 16 15 17z"/>
                        </svg>
                    </div>
                </div>

                <!-- Total Cell Voltage -->
                <div class="bg-slate-800/50 backdrop-blur rounded-lg p-3 border border-slate-700">
                    <div class="text-sm text-slate-300 mb-1">Cell Voltage Sum</div>
                    <div class="flex items-center justify-between">
                        <div>
                            <div id="battery-voltage-value" class="text-blue-400 font-bold text-xl">--V</div>
                            <div id="battery-cells-count" class="text-xs text-slate-400">0 cells</div>
                        </div>
                        <svg class="w-8 h-8 text-blue-400" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14.5 7.5V6c0-.55-.45-1-1-1h-3c-.55 0-1 .45-1 1v1.5h5zm-5 8V18c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-2.5h-5zM7 9v6h1.5V9H7zm8.5 0v6H17V9h-1.5z"/>
                        </svg>
                    </div>
                </div>

                <!-- Pack Voltage & Current -->
                <div class="bg-slate-800/50 backdrop-blur rounded-lg p-3 border border-slate-700">
                    <div class="text-sm text-slate-300 mb-1">Pack Status</div>
                    <div class="space-y-1">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-slate-400">Voltage:</span>
                            <span id="battery-pack-voltage" class="text-purple-400 font-bold">--V</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-slate-400">Current:</span>
                            <span id="battery-current-value" class="text-orange-400 font-bold">--A</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CAN Logging Status Bar -->
        <div class="glass-card rounded-lg p-4 mb-6">
            <h3 class="text-lg font-bold text-white mb-3 flex items-center">
                <svg class="w-5 h-5 mr-2 text-red-400" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM11 19H9v-2h2v2zm0-4H9V7h2v8z"/>
                </svg>
                CAN Logging Status
            </h3>
            
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div id="canlogging-status" class="status-indicator idle"></div>
                        <span id="canlogging-status-text" class="text-lg font-bold text-slate-300">IDLE</span>
                    </div>
                </div>
                <div class="text-right">
                    <div id="canlogging-start-time" class="text-sm text-slate-400">No active recording</div>
                </div>
            </div>
        </div>

        <!-- Main Speed and Controls Section -->
        <div class="glass-card rounded-lg p-8 mb-6">
            <div class="flex items-center justify-center space-x-12">
                
                 <!-- RL Motor -->
                <div class="text-center">
                    <div class="mini-gauge">
                        <div class="mini-circular-gauge" id="rpm-rl-gauge">
                            <div class="mini-gauge-inner">
                                <div id="rpm-rl-value" class="text-lg font-bold text-green-400">0</div>
                                <div class="text-lg text-slate-400">RPM</div>
                            </div>
                        </div>
                    </div>
                    <div class="text-sm font-bold text-cyan-400 mt-1">RL Motor</div>
                    <div class="text-sm font-bold text-cyan-400 mt-1" id="speed-rl-value">0 km/h</div>
                </div>

                
                <!-- APPS Bar -->
                <div class="flex flex-col items-center">
                    <div class="vertical-bar apps-bar">
                        <div class="bar-fill" id="apps-fill" style="height: 0%"></div>
                    </div>
                    <div class="mt-4 text-center">
                        <div class="text-lg font-bold text-green-400">APPS</div>
                        <div id="apps-value" class="text-2xl font-mono text-green-300">0%</div>
                    </div>
                </div>

                <!-- Speed Gauge -->
                <div class="flex flex-col items-center">
                    <div class="speed-gauge">
                        <div class="circular-gauge" id="speed-gauge">
                            <div class="gauge-inner">
                                <div id="speed-value" class="text-4xl font-bold text-white mb-2">0</div>
                                <div class="text-lg text-slate-400 mb-2">km/h</div>
                                <div class="text-sm text-slate-500">
                                    <span id="rpm-value">0</span> RPM
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 text-center">
                        <div class="text-xl font-bold text-blue-400">Vehicle Speed</div>
                    </div>
                </div>

                <!-- Brake Bar -->
                <div class="flex flex-col items-center">
                    <div class="vertical-bar brake-bar">
                        <div class="bar-fill" id="brake-fill" style="height: 0%"></div>
                    </div>
                    <div class="mt-4 text-center">
                        <div class="text-lg font-bold text-red-400">BRAKE</div>
                        <div id="brake-value" class="text-2xl font-mono text-red-300">0%</div>
                    </div>
                </div>
                <!-- RR Motor -->
                <div class="text-center">
                    <div class="mini-gauge">
                        <div class="mini-circular-gauge" id="rpm-rr-gauge">
                            <div class="mini-gauge-inner">
                                <div id="rpm-rr-value" class="text-lg font-bold text-green-400">0</div>
                                <div class="text-lg text-slate-400">RPM</div>
                            </div>
                        </div>
                    </div>
                    <div class="text-sm font-bold text-cyan-400 mt-1">RR Motor</div>
                    <div class="text-sm font-bold text-cyan-400 mt-1" id="speed-rr-value">0 km/h</div>
                </div>
            </div>
        </div>
        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Torque Chart -->
            <div class="glass-card rounded-lg p-6">
                <h3 class="text-xl font-bold mb-4 text-purple-400">Torque Over Time</h3>
                <div class="chart-container">
                    <canvas id="torque-chart"></canvas>
                </div>
            </div>

            <!-- RPM Chart -->
            <div class="glass-card rounded-lg p-6">
                <h3 class="text-xl font-bold mb-4 text-green-400">RPM Over Time</h3>
                <div class="chart-container">
                    <canvas id="rpm-chart"></canvas>
                </div>
            </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">

        <!-- Cell Voltage Chart -->
        <div class="glass-card rounded-lg p-6">
            <h3 class="text-xl font-bold mb-4 text-yellow-400">Cell Voltages (Groups)</h3>
                <div class="chart-container">
                    <canvas id="cell-voltage-chart"></canvas>
                </div>
            </div>

            <!-- Cell Temperature Chart -->
            <div class="glass-card rounded-lg p-6">
                <h3 class="text-xl font-bold mb-4 text-orange-400">Cell Temperatures (Groups)</h3>
                <div class="chart-container">
                    <canvas id="cell-temperature-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Inverters Status -->
        <div class="glass-card rounded-lg p-6 mb-6">
            <h3 class="text-xl font-bold mb-4 flex items-center">
                <span class="w-3 h-3 bg-purple-500 rounded-full mr-2"></span>
                Inverters Status
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- FL Inverter -->
                <div class="bg-slate-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <span class="font-bold text-purple-400">FL</span>
                        <span class="heartbeat-indicator heartbeat-fail" data-inv="1"></span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="inv-status-container">
                            <span class="status-unknown">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">Torque:</span>
                            <span class="inv-torque font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">DC V:</span>
                            <span class="inv-dc-voltage font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">DC I:</span>
                            <span class="inv-dc-current font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">MOS T:</span>
                            <span class="inv-mos-temp font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">MCU T:</span>
                            <span class="inv-mcu-temp font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">MOTOR T:</span>
                            <span class="inv-motor-temp font-mono">N/A</span>
                        </div>
                    </div>
                </div>

                <!-- FR Inverter -->
                <div class="bg-slate-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <span class="font-bold text-purple-400">FR</span>
                        <span class="heartbeat-indicator heartbeat-fail" data-inv="2"></span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="inv-status-container">
                            <span class="status-unknown">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">Torque:</span>
                            <span class="inv-torque font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">DC V:</span>
                            <span class="inv-dc-voltage font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">DC I:</span>
                            <span class="inv-dc-current font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">MOS T:</span>
                            <span class="inv-mos-temp font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">MCU T:</span>
                            <span class="inv-mcu-temp font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">MOTOR T:</span>
                            <span class="inv-motor-temp font-mono">N/A</span>
                        </div>
                    </div>
                </div>

                <!-- RL Inverter -->
                <div class="bg-slate-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <span class="font-bold text-purple-400">RL</span>
                        <span class="heartbeat-indicator heartbeat-fail" data-inv="3"></span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="inv-status-container">
                            <span class="status-unknown">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">Torque:</span>
                            <span class="inv-torque font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">DC V:</span>
                            <span class="inv-dc-voltage font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">DC I:</span>
                            <span class="inv-dc-current font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">MOS T:</span>
                            <span class="inv-mos-temp font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">MCU T:</span>
                            <span class="inv-mcu-temp font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">MOTOR T:</span>
                            <span class="inv-motor-temp font-mono">N/A</span>
                        </div>
                    </div>
                </div>

                <!-- RR Inverter -->
                <div class="bg-slate-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <span class="font-bold text-purple-400">RR</span>
                        <span class="heartbeat-indicator heartbeat-fail" data-inv="4"></span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="inv-status-container">
                            <span class="status-unknown">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">Torque:</span>
                            <span class="inv-torque font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">DC V:</span>
                            <span class="inv-dc-voltage font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">DC I:</span>
                            <span class="inv-dc-current font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">MOS T:</span>
                            <span class="inv-mos-temp font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">MCU T:</span>
                            <span class="inv-mcu-temp font-mono">N/A</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">MOTO T:</span>
                            <span class="inv-motor-temp font-mono">N/A</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="glass-card rounded-lg p-4 text-center">
            <p class="text-slate-400">NTURT Racing Team - Dynamic Dashboard v3.0</p>
        </div>
    </div>
</body>
</html>